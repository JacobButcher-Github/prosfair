# Prosfair

## Rules

### Pieces

Each player begins the game with the following pieces:

1 King
1 Queen
2 Rooks
2 Bishops
2 Knights
8 Pawns

There are the following additional pieces that are available during the game:

Commander, Corpse Knight, Armed Demon, Shock Troops, Apostate, Insurgent, Berserker, Battle Sphere, Blood Signet, Warden, Hexmancer, Soulbinder, Mirror Stalker, Warp Javelin, Echo Knight, Aether Grasp, Crimson Bolt, Rune Beast, Clockblade, Ember Vassal, Tetherling, Lantern Monk, Plague Widow, Iron Herald, Gloom Warden, Shard Wolf, Mech Oracle, Bone Marshal, Storm Caller, Astral Blade, Hive Keeper

Each has special characteristics which will be listed later. They do not start on the main board, but rather will show up in separate board.

### Game Ending

The game ends if the King is placed in checkmate, very similar to normal chess. There are also alternative win conditions which might appear within the separate boards on Realms.

### Experience

Before tackling Realms, Experience must be explained. Every time a piece is captured, the player who captured gains experience. Experience is determined by the point value of each piece. This will be provided later in the rules, but for instance: Pawns are worth 1, Knights and Bishops are worth 3 experience each when captured. Players begin the game needing 2 experience to gain a level. Each level requires 1.5x more experience than the previous, rounded down. So level 3 would require 3 experience. Level 4 would require 4 experience. Level 5 needs 6, Level 7 needs 9 and so on. Every 2nd level, a player can choose to upgrade one of their pieces. So at levels, 2, 4, 6 etc.

Each unit and its subsequent upgrades are locked to certain "tiers" determined by level. Players will not be able to select certain pieces for upgrade if the upgrade is above the tier the game is in.

Player experience can have a gap, and gaps will mean that one player can obtain certain upgrades

### Realms

Each time a player levels up, a "Realm" is deployed for both players. Realms are separate boards that begin at 3x3 size, and will expand out as the level of the player creating it increases.At level 5, the board will become a 5x5. At level 10, the board will become a 7x7. And finally at level 20, boards will become spheres of tiles.

Each player will select a reward for "winning" the Realm when a Realm is deployed. Rewards can be the following: Experience gain equal to twice the length of the board, an instant upgrade to a piece on a different board, or moving of any piece from the Realm to the main board. As the size of the board increases, so do the number of rewards. With a 5x5 board, a player can select 2 rewards, including selecting the same reward more than once.

Players will first place a Commander piece in the back rank of the board. They are allowed to choose the position on the back rank. Then they will sequentially go back and forth placing pieces up to a point cap or unit cap.

In 3x3 boards 5 units total will be allowed to be placed (Excluding Commanders) and a point cap of 5 exists.

In a 5x5 board, 13 units total will be allowed to be placed (Excluding Commanders) and a point cap of 13 exists.

In a 7x7 board, 25 units total will be allowed to be placed (Excluding Commanders) and a point cap of 25 exists.

The player who "owns" that realm will be allowed to place their piece first, then players will sequentially place pieces one after another. However, the back rank must be filled in for both players.

Finally, to move pieces on Realms, a player must first capture a piece from a different Realm, including the main board. This can lead to sequences of many captures across many of the realms.

### Piece Movements And Point Values

#### Normal Chess Pieces

| Rank | Title             | Movement Description                                                                              | Special Abilities                                                                                                         | Available at Level | Point Value |
| ---- | ----------------- | ------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------- | ------------------ | ----------- |
| Base | King              | Moves 1 square in any direction - horizontally, vertically or diagonally.                         | Cannot be captured, must be held into checkmate.                                                                          | Lvl 1              | ∞ pts       |
| Ⅰ    | Warlord           | Moves 2 squares in any direction.                                                                 | Once per game, can summon a pawn in any adjacent empty square                                                             | Lvl 2              | ∞ pts       |
| Ⅱ    | Grand Strategist  | Moves 2 squares in any direction.                                                                 | Can command one piece per turn to act twice. (Cannot target the same piece twice in a row)                                | Lvl 5              | ∞ pts       |
| ---- | ----------------- | -----------------------------------------------------                                             | ---------------------------------------------                                                                             | ------------------ | ----------- |
| Base | Queen             | Move any number of squares in any direction                                                       | None                                                                                                                      | Lvl 1              | 9 pts       |
| Ⅰ    | Arcblade Empress  | Same as before, but once every 3 turns can move to any square within 3 squares.                   | Captures cause adjacent enemy pieces to not be able to move next turn                                                     | Lvl 6              | 12 pts      |
| Ⅱ    | Void Monarch      | Same as before, but can phase through friendly units                                              | Can replace capturing with banishing. Banished units return in 3 turns. Can be used on friendly pieces as well.           | Lvl 9              | 15 pts      |
| ---- | ----------------  | ------------------------------------------------------------                                      | ----------------------------------------------------------------------------------                                        | ------------------ | ----------- |
| Base | Rook              | Moves in straight lines any number of squares horizontally and vertically along its row or column | None                                                                                                                      | Lvl 1              | 5 pts       |
| Ⅰ    | Siege Engine      | Can charge 4 tiles forward, pushing enemies 1 tile back.                                          | Capturing empowers it: +1 bonus tile of movement next turn.                                                               | Lvl 3              | 6 pts       |
| Ⅱ    | Fortress Titan    | Becomes stationary.                                                                               | Grants +1 movement to allies in same rank/file; enemies within 2 tiles can't teleport.                                    | Lvl 6              | 8 pts       |
| ---- | ----------------  | ------------------------------------------------------------                                      | ----------------------------------------------------------------------------------                                        | ------------------ | ----------- |
| Base | Bishop            | Moves diagonally any number of tiles.                                                             | None                                                                                                                      | Lvl 1              | 3 pts       |
| Ⅰ    | Warp Cleric       | Moves diagonally; may phase through 1 friendly unit per move.                                     | Adjacent allies can't be captured unless Bishop is captured first.                                                        | Lvl 3              | 6 pts       |
| Ⅱ    | Sigil Sage        | Same movement as previous.                                                                        | Can place 2 runes disabling all special abilities on an adjacent square (3-turn duration).                                | Lvl 6              | 7 pts       |
| ---- | ----------------  | ------------------------------------------------------------                                      | ----------------------------------------------------------------------------------                                        | ------------------ | ----------- |
| Base | Knight            | Moves in an L-shape: 2 tiles in one direction, 1 perpendicular.                                   | Can jump over pieces.                                                                                                     | Lvl 1              | 3 pts       |
| Ⅰ    | Phantom Rider     | Same L-shape; can teleport in that pattern ignoring obstacles.                                    | This piece's movement cannot be prevented. (Immune to effects that say 'cannot move next turn')                           | Lvl 3              | 5 pts       |
| Ⅱ    | Chaos Cavalier    | Can make 2 chained L-jumps in one turn. If an enemy piece was there, counts as a capture.         | Leaves behind “mirror shadows” count as a piece worth nothing. Capturing them does not grant a movement in another realm. | Lvl 6              | 7 pts       |
| ---- | ----------------  | ------------------------------------------------------------                                      | ----------------------------------------------------------------------------------                                        | ------------------ | ----------- |
| Base | Pawn              | Moves 1 tile forward; captures diagonally.                                                        | Can move 2 tiles on first move.                                                                                           | Lvl 1              | 1 pt        |
| Ⅰ    | Willed Soldier    | Same movement.                                                                                    | May Promote early into a piece if capturing equal/higher value; Cannot be captured if flanked by allies.                  | Lvl 2              | 3 pts       |
| Ⅱ    | Ascendant Echo    | Mimics adjacent unit’s abilities/movement for this turn.                                          | Immune to captures from units of less point value than it; only removable by banishment or special effects.               | Lvl 5              | 6 pts       |

#### Prosfair Specific Pieces

# | Name | Movement Description

1 | Corpse Knight | Moves like a knight, but may also move 1 square forward.
2 | Armed Demon | Moves 1 square diagonally, but may jump over 1 piece once per turn.
3 | Shock Troops | Moves like a rook, but limited to 2 squares per move.
4 | Apostate | Moves like a bishop, but can change direction mid-path once per turn.
5 | Insurgent | Moves like a pawn, but may move forward or sideways 1 square.
6 | Berserker | Moves like a queen, but must always move toward an enemy piece if possible.
7 | Battle Sphere | Moves 1 square in any direction, and cannot be blocked (phases through).
8 | Blood Signet | Moves like a king, but may mirror a nearby piece’s movement 1 square.
9 | Warden | Moves like a rook, but cannot move past the midpoint of any board.
10 | Hexmancer | Moves like a bishop, but alternates directions each turn (e.g., only right then only left).
11 | Soulbinder | Moves 1 square in any direction, and may switch positions with allied piece once per game.
12 | Mirror Stalker | Moves like a bishop, and can mimic the last enemy move once per 3 turns.
13 | Warp Javelin | Moves exactly 3 squares in a straight line, but cannot capture mid-path.
14 | Echo Knight | Moves like a knight, and repeats the move again if it lands on an empty tile.
15 | Aether Grasp | Moves up to 2 squares diagonally, may grapple adjacent enemy, freezing them next turn.
16 | Crimson Bolt | Moves up to 3 tiles orthogonally, but can jump over 1 piece.
17 | Rune Beast | Moves like a random chess piece (rook, bishop, knight) each turn.
18 | Clockblade | Moves exactly 2 tiles in cardinal (orthogonal) directions, must always move.
19 | Ember Vassal | Moves like a pawn, but also 1 tile diagonally backward.
20 | Tetherling | Moves 1 square in any direction, but only if tethered pair is within 2 tiles.
21 | Lantern Monk | Moves like a bishop, but only up to 2 squares, and may not capture.
22 | Plague Widow | Moves like a bishop, leaves a poisoned tile where it captures.
23 | Iron Herald | Moves like a rook, but gains +1 square of movement per realm captured.
24 | Gloom Warden | Moves like a king, but may not enter center 4x4 of main board.
25 | Shard Wolf | Moves like a knight, and may shift 1 extra tile diagonally after landing.
26 | Mech Oracle | Moves like a queen, but only every other turn.
27 | Bone Marshal | Moves like a pawn, but may push enemy pawns back 1 square instead of capturing.
28 | Storm Caller | Moves up to 2 squares diagonally, gains +1 range in rain terrain (if using terrain).
29 | Astral Blade | Moves like a queen, may teleport to same-file corner once per match.
30 | Hive Keeper | Moves like a king, but also may summon a Drone adjacent if standing still.

1.  Corpse Knight

    Stage 1: Grave Templar

        Returns to the board after being captured (on any realm board).

    Stage 2: Necrotic Champion

        Each time a piece dies, it gains 1 movement range up to +3.

2.  Armed Demon

    Stage 1: Fury Host

        Can sacrifice 1 friendly unit within 2 tiles to gain 2 extra moves.

    Stage 2: Abyss Fiend

        Burns every adjacent enemy unit at end of its turn (they lose next move).

3.  Shock Troops

    Stage 1: Blitz Operative

        Can move after capturing.

    Stage 2: Malice Form

        Can capture two pieces if positioned diagonally between them.

4.  Apostate

    Stage 1: Oathbreaker

        Immobilizes any adjacent ally with a lower level to shield itself.

    Stage 2: Void Herald

        Steals 1 ability from any captured piece.

5.  Insurgent

    Stage 1: Shadow Tactician

        Hidden until within 2 tiles of an enemy (can’t be targeted).

    Stage 2: Guerrilla Soul

        Can act twice on realm boards.

6.  Berserker

    Stage 1: Frenzy Reaver

        Increases movement each time it captures (max +3).

    Stage 2: Eternal Rampage

        If not moved or capturing for 2 turns, it goes berserk (attacks nearest unit automatically).

7.  Battle Sphere

    Stage 1: Gravity Node

        Pulls adjacent enemy units 1 tile closer every 2 turns.

    Stage 2: Orbital Core

        Prevents teleportation/warp abilities within 3 tiles.

8.  Blood Signet

    Stage 1: Living Sigil

        Occupies a square, projecting +1 move to any ally next to it.

    Stage 2: Cursed Emblem

        Units that step onto its tile are sealed (lose abilities for 2 turns).

9.  Warden

    Stage 1: Shieldbearer

        Cannot move but blocks all linear movement past it.

    Stage 2: Judgment Pillar

        Counterattacks anyone who captures a piece within 2 tiles.

10. Hexmancer

    Stage 1: Curse Slinger

        Can hex a tile to reduce enemy move range on it.

    Stage 2: Ritualist

        Can banish one piece from any realm per game.

11. Soulbinder

    Stage 1: Pact Wraith

        Links with 1 friendly piece; if one is captured, the other becomes invulnerable for 2 turns.

    Stage 2: Spirit Leech

        Drains abilities from enemy pieces it shares a rank or file with for 1 turn.

12. Mirror Stalker

    Stage 1: Phase Double

        Appears in two places simultaneously (phantom version is fake, swaps every turn).

    Stage 2: Shattered Phantom

        Upon capture, the real version reappears anywhere on a connected board.

13. Warp Javelin

    Stage 1: Spatial Skewer

        Can "throw" itself forward 3 tiles in a straight line, bypassing obstacles.

    Stage 2: Rift Spear

        Pierces through 2 enemy pieces in a line if they’re aligned.

14. Echo Knight

    Stage 1: Soundbound Scout

        Moves like a knight, but leaves a clone that lingers for 1 turn.

    Stage 2: Reverberant Blade

        After 3 moves, can repeat all moves in reverse once.

15. Aether Grasp

    Stage 1: Null Tendril

        Immobilizes enemies on diagonals within 2 tiles.

    Stage 2: Dreamlock Bloom

        Casts an aura: enemies must use 2 moves to escape tiles adjacent to it.

16. Crimson Bolt

    Stage 1: Blazing Spark

        Can jump to any tile of the same color within a 3x3 radius.

    Stage 2: Thunderlash Core

        Damages (stuns) enemy units it lands next to on teleport.

17. Rune Beast

    Stage 1: Glyphborn

        Randomly shifts movement type every 2 turns (rook/knight/bishop).

    Stage 2: Sigil Devourer

        Adopts last captured piece’s movement permanently.

18. Clockblade

    Stage 1: Gear Spinner

        Can reverse its last move once per game.

    Stage 2: Temporal Scythe

        If standing still for 3 turns, can undo one enemy move retroactively.

19. Ember Vassal

    Stage 1: Fire Marcher

        Burns the square it leaves, dealing passive damage (slow/stun).

    Stage 2: Infernal Gatekeeper

        If a piece is captured on a burned square, Ember gains +1 move permanently.

20. Tetherling

    Stage 1: Dualbody Crawler

        Must be paired with another Tetherling; they swap places on command.

    Stage 2: Chainspike Seraph

        When one dies, the other gains full movement and bonus capture for 3 turns.

21. Lantern Monk

    Stage 1: Lightforged

        Radiates fog-clearing effect; reveals hidden pieces within 3 tiles.

    Stage 2: Dawnwalker

        Grants movement bonus to all allies on connected tiles once every 3 turns.

22. Plague Widow

    Stage 1: Toxin Weaver

        Leaves poison trails for 2 turns behind each move.

    Stage 2: Venom Nexus

        Any poisoned square deals 1 turn of paralysis if stood upon.

23. Iron Herald

    Stage 1: Oathbreaker Sentinel

        Cannot be moved by enemy abilities.

    Stage 2: Steel Precursor

        Boosts morale: any piece adjacent gains 1 bonus tile of movement.

24. Gloom Warden

    Stage 1: Fog Bastion

        Obscures its tile and adjacent tiles, hiding friendly units.

    Stage 2: Eclipse Bunker

        Attacks through fog tiles do +1 rank of damage (bypass shields, effects).

25. Shard Wolf

    Stage 1: Frostbound Cub

        Captures freeze enemies it touches for 1 turn.

    Stage 2: Ice Fang Alpha

        Can leap and freeze any enemy 2 squares away (1-turn cooldown).

26. Mech Oracle

    Stage 1: Logic Seeder

        Can scan a piece to see its hidden ability once per realm.

    Stage 2: Singularity Eye

        Can predict and block 1 enemy move per 5 turns.

27. Bone Marshal

    Stage 1: Rattle Captain

        Revives 1 captured Pawn on a connected board.

    Stage 2: Ossuary King

        Summons a Bone Guard for every 3 kills (minions with limited movement).

28. Stormcaller

    Stage 1: Gale Whisperer

        Can push an enemy 1 square away (instead of capture).

    Stage 2: Typhoon Saint

        Forms a storm aura: enemy moves in its zone cost double.

29. Astral Blade

    Stage 1: Celestial Scout

        Ignores board boundaries (wraps around edges).

    Stage 2: Cosmic Edge

        Cuts through dimensions; attacks can reach diagonally adjacent realms.

30. Hive Keeper

    Stage 1: Drone Queen

        Spawns 1 Drone (weak pawn variant) every 4 turns.

    Stage 2: Nest Matriarch

        Drones near her gain +1 move and explode on capture.

## Code Things

### Planned features

#### 1. Fast API Backend (Python, Async)

Handle core REST API routes and game logic.

**Responsibilities**:

- Playter Authentication
- Creating, Joining and Managing games
- Processing game moves and rule validation
- Writing game state to MongoDB
- Publishing move/lobby/game events to Redis for Websocket delivery

#### 2. Websocket Server (Python)

Dedicated server to manage real-time WebSocket communication.

**Responsibilities:**

- Accept WebSocket connections from browser clients
- Subscribe to relevant Redis pub/sub channels
- Relay messages to connected players (moves, game updates, chat, etc.)
- Broadcast game/lobby events (e.g., new game available, player left)

#### 3. Redis (Pub/Sub Broker)

Decouple the FastAPI backend from the WebSocket layer.

**Usage:**

- FastAPI publishes events to Redis (move, chat, player joins)
- WebSocket server subscribes to those channels and pushes data to clients
- Optionally used to temporarily store state (e.g., active connections or transient events)

MongoDB to potentially store games and query with elastic search.
Web client in Typescript and snabbdom. Sass to generate the CSS.
What is Browserstack for browser testing?

#### 4. MongoDB (Primary Data Store)

**Collections:**

```json
games: {
  _id: ObjectId,
  game_code: "X4HZT",
  board_state: {...},
  players: [{ id: "player1", name: "Alice" }],
  created_at: ISODate,
  updated_at: ISODate,
  status: "waiting" | "in_progress" | "completed"
}

users: {
  _id: ObjectId,
  username: "alice",
  created_at: ISODate,
  stats: { wins: 5, losses: 3 }
}
```

#### 5. Frontend Client (Typescript + snabbdom + Sass)

Responsibilities:

- Render virtual DOM and UI updates via snabbdom
- Maintain local state for game session, board state, connection status
- Establish and manage WebSocket connection
- Display real-time updates: moves, chats, lobby changes
- Input handling: board clicks, move submission
- Styling via modular Sass
